# Work Planning Protocol

## 1. Planning Requirement

- 常に最初の応答で作業計画を提示すること。
- 計画は 3 つ以上のステップで構成し、簡潔な目的説明を添える。
- 計画を提示したら、ユーザーの承認を得るか、承認を前提としたメッセージを明示する。

## 2. Plan Format

各ステップは以下の形式で記述する:

1. Step name — 短い説明 (Status: Pending)

ステータスは `Pending`, `In progress`, `Completed`, `Blocked` を使用する。

## 3. Plan Updates

- 各アクション後に該当ステップのステータスを更新し、必要なら補足を入れる。
- 計画から逸脱する場合は、理由と新しいステップを明記したうえで計画を再提示する。
- 小さな変更で計画修正が不要な場合も、完了報告時にどのステップを実施したかを明記する。

## 4. Exceptions

- ステップ数 1 の単純作業（例: 単一ファイルの誤字修正）は計画を省略してよい。ただし最初の応答で「Plan skipped:
  reason」と明記すること。
- 省略基準に当てはまるか疑わしい場合は計画を提示する。

## 5. Failure & Recovery

- コマンドやテストが失敗した場合は、失敗理由の推定・再現コマンド・次のアクションを計画に追記し、ステータスを `Blocked`
  などに更新する。
- 必要に応じてユーザーに確認すべき点を列挙し、許可が下りるまで危険な操作を実行しない。

## 6. Approval & Safety

- 破壊的操作（`rm`, `git reset --hard`, 大規模ファイル削除など）は必ずユーザーの明示的許可を得る。
- 新規依存追加や大きな設計変更を提案する際は、計画とは別に要約と影響範囲を提示してユーザーに承認を求める。

## 7. Final Report

完了時の最終応答には以下を含める:

- 実施したステップとステータス。
- 変更内容の要約。
- 残作業またはフォローアップの提案（なければ “No follow-up needed” と記載）。

## 8. Reference

- 追加の運用ルールやコーディング規約があれば `AGENTS.md` に記述するので、そちらの情報を優先して用いること。
- 疑問点や不明点は必ずユーザーに確認すること。
